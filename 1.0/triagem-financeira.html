<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- NOVO: TÍTULO OTIMIZADO -->
    <title>Triagem Financeira para Médicos - DDica | Diagnóstico Rápido</title>
    <meta name="description" content="Responda a 10 perguntas-chave e receba uma análise instantânea da sua saúde financeira. Ferramenta exclusiva para médicos.">
    <meta name="keywords" content="triagem financeira, diagnóstico financeiro, finanças para médicos, questionário financeiro">
    <meta name="author" content="DDica">

    <!-- NOVO: TAGS DE RASTREAMENTO -->
    <!-- 1. Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WSH1YF9M2Y"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WSH1YF9M2Y');
    </script>
    <!-- 2. Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1151859876815343');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1151859876815343&ev=PageView&noscript=1"
    /></noscript>
    <!-- FIM DAS TAGS DE RASTREAMENTO -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js para o gráfico de radar -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Lato', sans-serif; background-color: #f8fafc; color: #334155; }
        .font-title { font-family: 'Poppins', sans-serif; }
        .cta-button {
            transition: all 0.3s ease-in-out;
        }
        .cta-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(14, 165, 233, 0.4);
        }
        .quiz-option:hover { border-color: #0ea5e9; background-color: #f0f9ff; }
        .quiz-option.selected {
            border-color: #0ea5e9;
            background-color: #e0f2fe;
            border-width: 2px;
            font-weight: 600;
            color: #0369a1;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .gradient-logo {
            background: linear-gradient(90deg, #0ea5e9 0%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        .gradient-btn {
            background: linear-gradient(90deg, #0ea5e9 0%, #10b981 100%);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="flex flex-col min-h-screen">

        <!-- Menu Principal -->
        <nav class="w-full bg-white/90 backdrop-blur-lg shadow-sm sticky top-0 z-50">
            <div class="container mx-auto px-6 py-3 flex justify-between items-center">
                <a href="index.html" class="text-2xl font-extrabold gradient-logo tracking-tight font-title">Ddica</a>
                <ul class="hidden lg:flex gap-6 items-center font-semibold text-slate-600 text-sm">
                    <li><a href="triagem-financeira.html" class="text-sky-600 border-b-2 border-sky-600 pb-1 font-bold">Triagem financeira</a></li>
                    <li><a href="metodo-phd.html" class="hover:text-sky-600 transition">Método PHD</a></li>
                    <li><a href="sobre-nos.html" class="hover:text-sky-600 transition">Sobre nós</a></li>
                    <li><a href="simuladores.html" class="hover:text-sky-600 transition">Simuladores</a></li>
                    <li><a href="novidades.html" class="hover:text-sky-600 transition">Novidades</a></li>
                </ul>
                <a href="https://wa.me/5519974073983?text=Ol%C3%A1%2C%20gostaria%20de%20saber%20mais%20sobre%20a%20Ddica%21%20%F0%9F%92%AC" target="_blank" class="hidden lg:inline-block gradient-btn text-white font-bold px-5 py-2.5 rounded-full shadow-lg hover:scale-105 transition-all cta-button text-sm" data-origin="Menu Principal (Triagem)">
                    Falar com especialista
                </a>
                <button id="mobile-menu-button" class="lg:hidden focus:outline-none">
                    <svg class="w-8 h-8 text-gray-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-8 6h8" /></svg>
                </button>
            </div>
            <div id="mobile-menu" class="hidden bg-white shadow-sm lg:hidden">
                <ul class="px-6 py-4 flex flex-col gap-4">
                    <li><a href="triagem-financeira.html" class="block text-sky-600 font-bold">Triagem financeira</a></li>
                    <li><a href="metodo-phd.html" class="block hover:text-sky-600 transition">Método PHD</a></li>
                    <li><a href="sobre-nos.html" class="block hover:text-sky-600 transition">Sobre nós</a></li>
                    <li><a href="simuladores.html" class="block hover:text-sky-600 transition">Simuladores</a></li>
                    <li><a href="novidades.html" class="block hover:text-sky-600 transition">Novidades</a></li>
                    <li>
                        <a href="https://wa.me/5519974073983?text=Ol%C3%A1%2C%20gostaria%20de%20saber%20mais%20sobre%20a%20Ddica%21%20%F0%9F%92%AC" target="_blank" class="w-full text-center gradient-btn text-white font-bold py-3 rounded-full shadow-lg" data-origin="Menu Principal Mobile (Triagem)">Falar com especialista</a>
                    </li>
                </ul>
            </div>
        </nav>

        <main class="flex-grow">
            <div class="container mx-auto px-6 max-w-4xl py-12 md:py-16">
                
                <!-- CONTEXTO E SEO ANTES DO QUIZ -->
                <div class="text-center mb-12">
                    <h1 class="text-3xl md:text-4xl font-extrabold text-slate-800 font-title">Faça em Poucos Minutos a sua Triagem Financeira para Médicos</h1>
                    
                    <h2 class="text-xl md:text-2xl font-semibold text-sky-600 mt-4">Por que fazer a triagem financeira?</h2>
                    <p class="text-slate-600 mt-2 max-w-3xl mx-auto">Esta ferramenta exclusiva para a classe médica ajuda a identificar onde você está perdendo dinheiro, como organizar dívidas e investimentos e a visualizar o seu futuro. Você receberá um diagnóstico preciso dos principais desafios financeiros.</p>
                    
                    <h3 class="text-lg font-semibold text-slate-700 mt-6">O que você vai descobrir com a triagem?</h3>
                    <div class="flex justify-center flex-wrap gap-4 mt-2 text-sm max-w-3xl mx-auto">
                        <span class="bg-gray-200 py-1 px-3 rounded-full">Risco Tributário</span>
                        <span class="bg-gray-200 py-1 px-3 rounded-full">Potencial de Crescimento</span>
                        <span class="bg-gray-200 py-1 px-3 rounded-full">Necessidade de Proteção</span>
                        <span class="bg-gray-200 py-1 px-3 rounded-full">Organização de Fluxo de Caixa</span>
                    </div>

                    <p class="text-sm text-gray-500 mt-8">
                        <i class="fa-solid fa-lock text-green-500 mr-1"></i> Seus dados ficam seguros. Respeitamos sua <a href="politica-de-privacidade.html" class="underline hover:text-sky-600">privacidade</a> e usaremos os dados somente para o seu diagnóstico e contato.
                    </p>
                </div>
                
                <!-- QUIZ FORM (VERSÃO ESTÁVEL: ROLAGEM) -->
                <div id="quiz-form">
                    <div id="quiz-container" class="space-y-10 bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200">
                        <!-- O conteúdo será injetado pelo JS em blocos para rolagem, não para transição -->
                    </div>
                    <div class="text-center mt-8">
                        <!-- Botão único para acionar o modal, só ativo se todas as respostas estiverem marcadas -->
                        <button id="calculate-btn" type="button" class="w-full md:w-auto gradient-btn text-white px-12 py-4 rounded-full font-bold text-lg cta-button disabled:bg-gray-400 disabled:shadow-none disabled:cursor-not-allowed" disabled>Ver meu Diagnóstico</button>
                    </div>
                </div>
                
                <div id="quiz-results" class="hidden mt-16 animate-fade-in">
                    <!-- Conteúdo do resultado é injetado após o salvamento do lead -->
                </div>
            </div>
        </main>

        <footer class="bg-slate-900 text-white">
            <div class="container mx-auto px-6 py-12">
                <div class="grid grid-cols-1 lg:grid-cols-10 gap-10">
                    <div class="lg:col-span-4 text-center lg:text-left"><h3 class="text-3xl font-extrabold tracking-tight gradient-logo inline-block font-title">Ddica</h3><p class="mt-4 text-slate-400 max-w-md mx-auto lg:mx-0">Cuidamos do seu futuro para que você possa focar no que faz de melhor.</p></div>
                    <div class="lg:col-span-2 text-center lg:text-left"><h4 class="font-bold text-lg text-white tracking-wider font-title">Navegação</h4><ul class="mt-4 space-y-2"><li><a href="triagem-financeira.html" class="text-slate-400 hover:text-sky-400 transition">Triagem financeira</a></li><li><a href="metodo-phd.html" class="text-slate-400 hover:text-sky-400 transition">Método PHD</a></li><li><a href="sobre-nos.html" class="text-slate-400 hover:text-sky-400 transition">Sobre nós</a></li><li><a href="simuladores.html" class="text-slate-400 hover:text-sky-400 transition">Simuladores</a></li><li><a href="novidades.html" class="text-slate-400 hover:text-sky-400 transition">Novidades</a></li></ul></div>
                    <div class="lg:col-span-2 text-center lg:text-left"><h4 class="font-bold text-lg text-white tracking-wider font-title">Institucional</h4><ul class="mt-4 space-y-2"><li><a href="politica-de-privacidade.html" class="text-slate-400 hover:text-sky-400 transition">Política de privacidade</a></li><li><a href="termos-de-uso.html" class="text-slate-400 hover:text-sky-400 transition">Termos de uso</a></li><li><a href="cookies.html" class="text-slate-400 hover:text-sky-400 transition">Cookies</a></li></ul></div>
                    <div class="lg:col-span-2 text-center lg:text-left"><h4 class="font-bold text-lg text-white tracking-wider font-title">Contato</h4><ul class="mt-4 space-y-3 text-slate-400"><li class="flex items-center gap-2 justify-center lg:justify-start"><i class="fa-solid fa-envelope fa-fw"></i><span>contato@ddica.com.br</span></li><li class="flex items-center gap-2 justify-center lg:justify-start"><i class="fa-brands fa-whatsapp fa-fw"></i><span>(11) 96647-9058</span></li></ul><div class="mt-4 flex gap-4 justify-center lg:justify-start"><a href="https://www.linkedin.com/company/ddica" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="text-slate-400 hover:text-sky-400 transition text-2xl"><i class="fa-brands fa-linkedin"></i></a><a href="https://www.instagram.com/ddicasaudefinanceira/" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="text-slate-400 hover:text-sky-400 transition text-2xl"><i class="fa-brands fa-instagram"></i></a></div></div>
                </div>
                <div class="mt-12 pt-8 border-t border-slate-800 text-center text-slate-500 text-sm"><p>&copy; 2025 Ddica. Todos os direitos reservados. Uma consultoria de vida e finanças para médicos.</p></div>
            </div>
        </footer>

    </div>
    
    <!-- Ícone Flutuante do WhatsApp -->
    <a href="https://wa.me/5519974073983?text=Ol%C3%A1%2C%20gostaria%20de%20saber%20mais%20sobre%20a%20Ddica%21%20%F0%9F%92%AC" target="_blank" class="fixed bottom-6 right-6 bg-[#25D366] text-white w-16 h-16 rounded-full flex items-center justify-center shadow-2xl z-40 hover:scale-110 transition-transform">
        <i class="fa-brands fa-whatsapp text-4xl"></i>
    </a>
    
    <!-- Modal de Contato (ETAPA FINAL DE CAPTURA) -->
    <div id="contact-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md relative animate-fade-in">
             <div class="p-6 text-center bg-slate-100 rounded-t-2xl border-b"><h3 class="text-2xl font-bold text-slate-800 font-title">Seu diagnóstico está pronto!</h3></div>
             <div class="p-8">
                <p class="text-slate-600 mb-6 text-center font-bold">Para receber seu diagnóstico completo e o plano de ação personalizado, preencha seus dados:</p>
                <form id="contact-form" class="space-y-4">
                    <div><label for="name" class="block text-sm font-semibold text-gray-700 mb-1">Nome</label><input type="text" id="name" name="name" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500" required></div>
                    <div><label for="email" class="block text-sm font-semibold text-gray-700 mb-1">Email</label><input type="email" id="email" name="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500" required></div>
                    <div><label for="phone" class="block text-sm font-semibold text-gray-700 mb-1">Whatsapp</label><input type="tel" id="phone" name="phone" placeholder="(XX) XXXXX-XXXX" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500" required></div>
                    <p class="text-xs text-gray-500 pt-2 flex items-center">
                        <input type="checkbox" id="lgpd-check" required class="mr-2 h-4 w-4 text-sky-600 focus:ring-sky-500 border-gray-300 rounded">
                        <label for="lgpd-check">Li e aceito a <a href="politica-de-privacidade.html" target="_blank" class="underline">Política de Privacidade</a> e concordo em receber contato da DDica.</label>
                    </p>
                    <button type="submit" class="w-full gradient-btn text-white p-3 rounded-lg font-bold text-lg cta-button mt-4">Receber Diagnóstico e Plano de Ação</button>
                </form>
                <div id="form-feedback" class="hidden mt-4 text-center p-3 rounded-md"></div>
             </div>
             <button id="close-contact-modal-btn" class="absolute top-3 right-3 text-gray-400 hover:text-gray-800 transition-colors"><i class="fa-solid fa-xmark fa-lg"></i></button>
        </div>
    </div>

<script type="module">
    // Variáveis globais para Firebase e redirecionamento
    let app, db, auth;
    const RESULTADO_URL = 'triagem-financeira-resultado.html';
    
    // Configurações do Firebase (Inseridas pelo Utilizador - Projeto ddica-final)
    const firebaseConfig = {
        apiKey: "AIzaSyCyRpcNypLumJrp6-fabV_NogDHPBIirQU", 
        authDomain: "ddica-final.firebaseapp.com",
        projectId: "ddica-final", 
        storageBucket: "ddica-final.firebasestorage.app",
        messagingSenderId: "1010206020743",
        appId: "1:1010206020743:web:199d80970258975ac31422",
    };

    // Função de inicialização do Firebase e autenticação
    async function initializeFirebaseAndAuth() {
        // Importações da SDK do Firebase (devem estar aqui para o type="module")
        const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js");
        const { getFirestore, collection, addDoc, serverTimestamp } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js");
        const { getAuth, signInAnonymously } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js");
        
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            
            // Tenta autenticar anonimamente (necessário para o Firestore)
            await signInAnonymously(auth);
            return true;
        } catch (error) {
            console.error("Erro na inicialização/autenticação Firebase:", error);
            // NÃO RETORNA FALSE, DEIXA O RESTO DO JS CARREGAR MESMO SE A AUTENTICAÇÃO FALHAR
            return false;
        }
    }
    
    // Lógica do Quiz
    const questionsData = [
        { id: 1, key: "organizacao", text: "Como você descreveria seu sistema de controle financeiro hoje?", options: [ { text: "Caótico ou inexistente. A rotina não me permite ter um controle claro.", value: 1 }, { text: "Básico. Tenho uma ideia geral das minhas contas, mas sem um acompanhamento detalhado.", value: 2 }, { text: "Organizado. Uso um app ou planilha e sei para onde meu dinheiro vai.", value: 3 }, { text: "Otimizado. Meu sistema é integrado à minha contabilidade e investimentos.", value: 4 } ] },
        { id: 2, key: "pj", text: "Se você atua como Pessoa Jurídica (PJ), como é a gestão dessa conta?", options: [ { text: "Uso a conta da PJ para despesas pessoais com frequência, é mais prático.", value: 1 }, { text: "Tento separar, mas às vezes misturo. Tenho um pró-labore, mas não é fixo.", value: 2 }, { text: "Totalmente separada, com pró-labore definido e distribuição de lucros orientada.", value: 4 }, { text: "Não se aplica, atuo apenas como Pessoa Física.", value: 1 } ] },
        { id: 3, key: "investimentos", text: "Qual frase melhor define sua carteira de investimentos hoje?", options: [ { text: "Praticamente tudo está na poupança ou parado na conta corrente.", value: 1 }, { text: "Tenho alguns produtos que o gerente/ assessor de investimentos recomendou.", value: 2 }, { text: "Possuo uma carteira diversificada (renda fixa, ações, fundos) que eu mesmo montei.", value: 3 }, { text: "Sigo um plano de alocação de ativos claro, com revisão periódica e foco no longo prazo.", value: 4 } ] },
        { id: 4, key: "protecao", text: "Pensando em proteção (seguro de vida, invalidez, RC), qual seu nível de preparo?", options: [ { text: "Não tenho um plano específico. Confio na minha capacidade de gerar renda para superar qualquer problema.", value: 1 }, { text: "Tenho um seguro de vida e/ou de responsabilidade civil, mas não reviso as coberturas há anos.", value: 2 }, { text: "Tenho seguros, mas não sei se as coberturas e valores estão alinhados ao meu patrimônio.", value: 3 }, { text: "Meu planejamento de riscos foi revisado por um especialista e me sinto totalmente protegido.", value: 4 } ] },
        { id: 5, key: "aposentadoria", text: "Como você visualiza sua aposentadoria?", options: [ { text: "É uma preocupação distante. Provavelmente terei que trabalhar até quando não quiser mais.", value: 1 }, { text: "Espero que o retorno do INSS seja suficiente.", value: 2 }, { text: "Tenho um plano de previdência privada, mas não sei se o valor acumulado será o bastante.", value: 3 }, { text: "Tenho um número claro em mente (ex: R$ 5 milhões) e um plano de investimentos ativo para chegar lá.", value: 4 } ] },
        { id: 6, key: "dividas", text: "Qual sua relação com dívidas (financiamentos, FIES, etc.)?", options: [ { text: "Tenho dívidas com juros altos e me sinto sobrecarregado por elas.", value: 1 }, { text: "Tenho parcelamentos, mas eles consomem uma parte significativa da minha renda.", value: 2 }, { text: "Tenho parcelamentos, mas estão sob controle e não comprometem meus investimentos.", value: 3 }, { text: "Não possuo dívidas ou tenho um plano agressivo para quitá-las rapidamente.", value: 4 } ] },
        { id: 7, key: "contratos", text: "Seus contratos de trabalho e prestação de serviços foram revisados por um advogado especialista?", options: [ { text: "Não, nunca fiz uma revisão profissional dos meus contratos.", value: 1 }, { text: "Revisei apenas no início, mas não acompanho as mudanças.", value: 2 }, { text: "Sim, tenho suporte jurídico para garantir que meus contratos me protejam.", value: 4 }, { text: "Não tenho contratos formais na maioria dos meus vínculos.", value: 1 } ] },
        { id: 8, key: "sucessao", text: "Você já iniciou alguma forma de planejamento sucessório?", options: [ { text: "Não, considero um assunto para o futuro distante ou não tenho conhecimento suficiente sobre o tema.", value: 1 }, { text: "Já conversei sobre, mas não tenho nenhum documento ou estrutura formalizada.", value: 2 }, { text: "Tenho um testamento, mas não sei se é a forma mais eficiente.", value: 3 }, { text: "Sim, já tenho uma estrutura (holding, doação) para garantir a tranquilidade da minha família.", value: 4 } ] },
        { id: 9, key: "educacao", text: "Qual seu principal meio de informação sobre finanças e investimentos?", options: [ { text: "Não acompanho ativamente, a rotina não permite.", value: 1 }, { text: "Sigo dicas de amigos, familiares ou do gerente/ assessor de investimentos do banco.", value: 2 }, { text: "Leio notícias e sigo influenciadores digitais sobre o assunto.", value: 3 }, { text: "Estudo o tema com profundidade, através de livros e cursos especializados.", value: 4 } ] },
        { id: 10, key: "sentimento", text: "Qual sentimento melhor descreve sua vida financeira hoje?", options: [ { text: "Ansiedade ou frustração. Sinto que trabalho muito e o resultado não acompanha.", value: 1 }, { text: "Confusão. São muitas informações e não sei qual o melhor caminho a seguir.", value: 2 }, { text: "Esperança. Sinto que estou no caminho certo, mas poderia ser mais eficiente.", value: 3 }, { text: "Tranquilidade. Sinto que tenho um plano claro e estou no controle do meu futuro.", value: 4 } ] }
    ];

    function calculateProfile(answers) {
        const pillars = {
            'Organização e Gestão': (answers.organizacao.value + answers.pj.value) / 2,
            'Eficiência Tributária': answers.pj.value,
            'Construção de Patrimônio': (answers.investimentos.value + answers.dividas.value) / 2,
            'Gestão de Riscos': (answers.protecao.value + answers.contratos.value) / 2,
            'Planejamento de Futuro': (answers.aposentadoria.value + answers.sucessao.value) / 2
        };
        
        const overallScore = Object.values(answers).reduce((sum, answer) => sum + answer.value, 0);

        if (overallScore >= 35) {
            return { title: 'O Estrategista', profile: 'Você já tem uma base financeira sólida e um bom controle sobre sua vida.', scores: pillars };
        }

        const lowestPillarKey = Object.keys(pillars).reduce((a, b) => pillars[a] < pillars[b] ? a : b);
        
        switch (lowestPillarKey) {
            case 'Organização e Gestão':
                return { title: 'O Realizador Desorganizado', profile: 'Sua capacidade de gerar renda é altíssima, mas a falta de tempo e organização está impedindo que seu esforço se transforme em riqueza.', scores: pillars };
            case 'Eficiência Tributária':
                return { title: 'O Contribuinte Generoso', profile: 'Você é organizado e provavelmente investe, mas por falta de uma estratégia fiscal especializada, está "doando" uma parte significativa da sua renda ao governo.', scores: pillars };
            case 'Construção de Patrimônio':
                return { title: 'O Poupador Cauteloso', profile: 'Você tem a excelente disciplina de guardar dinheiro, mas seu patrimônio não está a crescer com a velocidade que poderia.', scores: pillars };
            case 'Gestão de Riscos':
                return { title: 'O Pilar Desprotegido', profile: 'Você está a construir um patrimônio sólido, mas ele está vulnerável. A ausência de uma "blindagem" adequada pode colocar tudo a perder diante de um imprevisto.', scores: pillars };
            default:
                return { title: 'O Navegador sem Bússola', profile: 'Você gerencia bem o presente, mas o futuro ainda é uma grande interrogação.', scores: pillars };
        }
    }


    document.addEventListener('DOMContentLoaded', function () {
        // Chama a inicialização do Firebase
        initializeFirebaseAndAuth();

        // Elementos do Quiz
        const quizContainer = document.getElementById('quiz-container');
        const calculateBtn = document.getElementById('calculate-btn');
        const contactModal = document.getElementById('contact-modal');
        const contactForm = document.getElementById('contact-form');
        const closeContactModalBtn = document.getElementById('close-contact-modal-btn');
        const feedbackDiv = document.getElementById('form-feedback');
        const phoneInput = document.getElementById('phone');
        
        let userAnswers = {};

        // RENDERIZAÇÃO E NAVEGAÇÃO
        function renderQuiz() {
            if (!quizContainer) return;
            quizContainer.innerHTML = ''; // Limpa o contêiner
            
            // Renderiza as perguntas em blocos para rolagem vertical
            questionsData.forEach(q => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question animate-fade-in space-y-3 p-4 border-b border-gray-100 last:border-none';
                questionDiv.dataset.key = q.key;
                
                // Adiciona o número da pergunta na frente
                let optionsHtml = q.options.map(opt => 
                    `<div class="quiz-option border border-gray-300 p-4 rounded-lg cursor-pointer transition-all" 
                          data-key="${q.key}" data-value="${opt.value}" data-text="${opt.text}">
                        <p>${opt.text}</p>
                    </div>`
                ).join('');

                questionDiv.innerHTML = `<p class="font-bold text-lg text-slate-800 mb-4">${q.id}. ${q.text}</p><div class="space-y-3">${optionsHtml}</div>`;
                quizContainer.appendChild(questionDiv);
            });
            
            // Listener para seleção de opção
            quizContainer.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', handleOptionSelect);
            });
            
            // Verifica o estado inicial
            checkAllAnswered();
        }

        function handleOptionSelect(event) {
            const option = event.currentTarget;
            const questionKey = option.dataset.key;
            
            // Remove seleção anterior na mesma pergunta
            option.closest('.quiz-question').querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            
            // Salva a resposta
            userAnswers[questionKey] = {
                value: parseInt(option.dataset.value),
                text: option.dataset.text
            };
            
            // Verifica se todas foram respondidas para habilitar o botão
            checkAllAnswered();
        }

        function checkAllAnswered() {
            calculateBtn.disabled = Object.keys(userAnswers).length !== questionsData.length;
        }
        
        // Listener para o botão 'Ver meu Diagnóstico' (agora calculate-btn)
        if (calculateBtn) {
            calculateBtn.addEventListener('click', () => {
                // 1. Abre o modal de contato
                contactModal.classList.remove('hidden');
            });
        }


        // LÓGICA DO MODAL DE CONTATO (SUBMISSÃO)
        closeContactModalBtn.addEventListener('click', () => contactModal.classList.add('hidden'));
        contactModal.addEventListener('click', (e) => { if (e.target === contactModal) contactModal.classList.add('hidden'); });
        
        if(phoneInput) {
            phoneInput.addEventListener('input', e => {
                let value = e.target.value.replace(/\D/g, '');
                value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
                e.target.value = value.slice(0, 15);
            });
        }

        if (contactForm) {
            contactForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitButton = contactForm.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.textContent = 'Aguarde...';

                // Verifica se o Firebase foi inicializado e se a autenticação funcionou
                if (!db || !auth.currentUser) {
                     console.error("Erro: Firebase não inicializado ou autenticação falhou.");
                     feedbackDiv.textContent = 'Erro interno: A conexão com o servidor falhou. Tente novamente ou entre em contato.';
                     feedbackDiv.className = 'mt-4 text-center p-3 rounded-md bg-red-100 text-red-800';
                     feedbackDiv.classList.remove('hidden');
                     submitButton.disabled = false;
                     submitButton.textContent = 'Receber Diagnóstico e Plano de Ação';
                     return;
                }
                
                // Calcula o perfil DEPOIS que o usuário clica em submeter
                const { addDoc, collection, serverTimestamp } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js");
                const profile = calculateProfile(userAnswers);
                
                const leadData = { 
                    nome: contactForm.name.value, 
                    email: contactForm.email.value, 
                    telefone: contactForm.phone.value, 
                    dataDeCriacao: serverTimestamp(), 
                    status: 'Novo Lead Triagem',
                    origem: "Triagem Financeira Completa",
                    diagnosticoTriagem: {
                        perfilDiagnosticado: profile.title,
                        respostas: userAnswers,
                        scores: profile.scores
                    }
                };
                                
                try {
                    // SALVANDO NO FIRESTORE
                    await addDoc(collection(db, "triagem_leads"), leadData);
                    
                    feedbackDiv.textContent = 'Sucesso! Redirecionando para o seu diagnóstico...';
                    feedbackDiv.className = 'mt-4 text-center p-3 rounded-md bg-green-100 text-green-800';
                    feedbackDiv.classList.remove('hidden');
                    contactForm.classList.add('hidden');
                    
                    // REDIRECIONAMENTO FINAL
                    setTimeout(() => {
                        window.location.href = RESULTADO_URL;
                    }, 1500);

                } catch (error) {
                    console.error("Erro ao salvar no Firestore: ", error);
                    feedbackDiv.textContent = 'Ocorreu um erro ao salvar o lead. Tente novamente.';
                    feedbackDiv.className = 'mt-4 text-center p-3 rounded-md bg-red-100 text-red-800';
                    submitButton.disabled = false;
                    submitButton.textContent = 'Receber Diagnóstico e Plano de Ação';
                }
            });
        }
        
        // Chamada Inicial
        renderQuiz();
    });
</script>
</body>
</html>
